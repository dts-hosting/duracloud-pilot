<!DOCTYPE html>
<html lang="en">
<head>
  <title>DuraCloud Storage Report - {{.StackName}}</title>
  <style>
      body {
          font-family: Arial, sans-serif;
          margin: 20px;
      }

      .summary {
          background: #f5f5f5;
          padding: 15px;
          border-radius: 5px;
          margin-bottom: 20px;
      }

      .bucket {
          margin-bottom: 30px;
          border: 1px solid #ddd;
          padding: 15px;
          border-radius: 5px;
      }

      .bucket h3 {
          margin-top: 0;
          color: #333;
      }

      .prefix-stats {
          margin-left: 20px;
      }

      .prefix-item {
          margin-bottom: 5px;
          padding: 5px;
          background: #f9f9f9;
          border-radius: 3px;
      }

      table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 10px;
      }

      th, td {
          padding: 8px;
          text-align: left;
          border-bottom: 1px solid #ddd;
      }

      th {
          background-color: #f5f5f5;
      }

      .metric {
          font-weight: bold;
          color: #2c5282;
      }
  </style>
</head>
<body>
<h1>DuraCloud Storage Report</h1>
<p><strong>Stack:</strong> {{.StackName}}</p>
<p><strong>Generated:</strong> {{.GeneratedAt.Format "2006-01-02 15:04:05 UTC"}}</p>

<div class="summary">
  <h2>Summary</h2>
  <p><span class="metric">Total Buckets:</span> {{formatNumber .TotalBuckets}}</p>
  <p><span class="metric">Total Storage:</span> {{formatBytes .TotalSize}}</p>
  <p><span class="metric">Total Files:</span> {{formatNumber .TotalObjects}}</p>
</div>

<h2>Bucket Details</h2>

<div class="summary">
  <p>Details begin with a summary of total storage and number of files per bucket. This data is refreshed every 24 hours so the numbers may not be real-time accurate to when the report was generated.</p>
  <p>Top-Level Prefix data treats each root level "folder" (prefix), if any, as a container for calculating file and storage totals exclusively within that prefix.</p>
</div>

{{range .BucketStats}}
<div class="bucket">
  <h3>{{.Name}}</h3>
  <p><span class="metric">Storage:</span> {{formatBytes .TotalSize}}</p>
  <p><span class="metric">Files:</span> {{formatNumber .TotalObjects}}</p>

  {{if .PrefixStats}}
  <h4>Top-Level Prefixes</h4>
  <div class="prefix-stats">
    {{range .PrefixStats}}
    <div class="prefix-item">
      <strong>{{.Prefix}}</strong> - {{formatBytes .Size}} ({{formatNumber .ObjectCount}} files)
    </div>
    {{end}}
  </div>
  {{end}}

  {{if .Tags}}
  <h4>Tags</h4>
  <table>
    <tr>
      <th>Key</th>
      <th>Value</th>
    </tr>
    {{range $key, $value := .Tags}}
    <tr>
      <td>{{$key}}</td>
      <td>{{$value}}</td>
    </tr>
    {{end}}
  </table>
  {{end}}
</div>
{{end}}
</body>
</html>